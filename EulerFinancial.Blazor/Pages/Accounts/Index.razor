@page "/Accounts"

@inherits ModelIndex<Account>

<PageTitle>@PageTitle.AsPageTitle()</PageTitle>
<div><h4>@PageTitle</h4></div>

<div>
    <a class="link-button" href="@($"{PageIndexUri}/Create")"
       @onclick="@(args => NavigateToCreate($"{Guid.NewGuid()}"))"
       @onclick:preventDefault>
        @StringResource.Button_Create_Caption
    </a>
</div>

@if (IsLoading)
{
    <p><em>@StringResource.Page_Loading_Caption</em></p>
}
else
{
    <div>
        <SearchInputTable TModel=@Account
                      ComparisonOperators=@ComparisonOperators
                      ExpressionBuilder=@ExpressionBuilder
                      SearchFields=@SearchFields
                      OnSearchClick=@(args => SearchClicked(args))>
        </SearchInputTable>
    </div>
    <span>
        <DataGrid Data="@Models" class="datagrid">
            <DataGridColumn Property=@nameof(Account.AccountNavigation.AccountObjectCode)
                        Caption=@(ModelMetadata.NameFor<AccountObject>(nameof(AccountObject.AccountObjectCode)))>
                <CellTemplate Context="model">
                    <a href="@($"{PageIndexUri}/Details/{model.AccountId}")" @onclick="@(args => NavigateToDetail(model, args))"
                   @onclick:preventDefault>
                        @model.AccountNavigation.AccountObjectCode.ToUpper()
                    </a>
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.AccountNavigation.ObjectDisplayName)
                        Caption=@(ModelMetadata.NameFor<AccountObject>(nameof(AccountObject.ObjectDisplayName)))>
                <CellTemplate Context="model">
                    @model.AccountNavigation.ObjectDisplayName
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.AccountNavigation.ObjectDescription)
                        Caption=@(ModelMetadata.NameFor<AccountObject>(nameof(AccountObject.ObjectDescription)))>
                <CellTemplate Context="model">
                    @model.AccountNavigation.ObjectDescription
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.AccountNavigation.StartDate)
                        Caption=@(ModelMetadata.NameFor<AccountObject>(nameof(AccountObject.StartDate)))>
                <CellTemplate Context="model">
                    @model.AccountNavigation.StartDate.ToShortDateString()
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.AccountNavigation.CloseDate)
                        Caption=@(ModelMetadata.NameFor<AccountObject>(nameof(AccountObject.CloseDate)))>
                <CellTemplate Context="model">
                    @model.AccountNavigation.CloseDate?.ToShortDateString()
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.AccountNumber)
                        Caption=@(ModelMetadata.NameFor<Account>(nameof(Account.AccountNumber)))>
                <CellTemplate Context="model">
                    @model.AccountNumber
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.DisplayOrder)
                        Caption=@(ModelMetadata.NameFor<Account>(nameof(Account.DisplayOrder)))>
                <CellTemplate Context="model">
                    @model.DisplayOrder
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.BooksClosedDate)
                        Caption=@(ModelMetadata.NameFor<Account>(nameof(Account.BooksClosedDate)))>
                <CellTemplate Context="model">
                    @model.BooksClosedDate?.ToShortDateString()
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.IsComplianceTradable)
                        Caption=@(ModelMetadata.NameFor<Account>(nameof(Account.IsComplianceTradable)))>
                <CellTemplate Context="model">
                    @model.IsComplianceTradable
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.HasWallet)
                        Caption=@(ModelMetadata.NameFor<Account>(nameof(Account.HasWallet)))>
                <CellTemplate Context="model">
                    @model.HasWallet
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.HasBankTransaction)
                        Caption=@(ModelMetadata.NameFor<Account>(nameof(Account.HasBankTransaction)))>
                <CellTemplate Context="model">
                    @model.HasBankTransaction
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.HasBrokerTransaction)
                        Caption=@(ModelMetadata.NameFor<Account>(nameof(Account.HasBrokerTransaction)))>
                <CellTemplate Context="model">
                    @model.HasBrokerTransaction
                </CellTemplate>
            </DataGridColumn>
            <DataGridColumn Property=@nameof(Account.AccountCustodian.CustodianCode)
                        Caption=@(ModelMetadata.NameFor<Account>(nameof(Account.AccountCustodianId)))>
                <CellTemplate Context="model">
                    @model.AccountCustodian?.CustodianCode
                </CellTemplate>
            </DataGridColumn>
        </DataGrid>
        @*        <table class="table">
            <thead>
            <tr>
            <th>
            @(ModelMetadata.NameFor<AccountObject>(nameof(AccountObject.AccountObjectCode)))
            </th>
            <th>
            @(ModelMetadata.NameFor<AccountObject>(nameof(AccountObject.ObjectDisplayName)))
            </th>
            <th>
            @(ModelMetadata.NameFor<AccountObject>(nameof(AccountObject.StartDate)))
            </th>
            <th>
            @(ModelMetadata.NameFor<AccountObject>(nameof(AccountObject.CloseDate)))
            </th>
            <th>
            @(ModelMetadata.NameFor<Account>(nameof(Account.AccountNumber)))
            </th>
            <th>
            @(ModelMetadata.NameFor<Account>(nameof(Account.DisplayOrder)))
            </th>
            <th>
            @(ModelMetadata.NameFor<Account>(nameof(Account.BooksClosedDate)))
            </th>
            <th>
            @(ModelMetadata.NameFor<Account>(nameof(Account.IsComplianceTradable)))
            </th>
            <th>
            @(ModelMetadata.NameFor<Account>(nameof(Account.HasWallet)))
            </th>
            <th>
            @(ModelMetadata.NameFor<Account>(nameof(Account.HasBankTransaction)))
            </th>
            <th>
            @(ModelMetadata.NameFor<Account>(nameof(Account.HasBrokerTransaction)))
            </th>
            <th>
            @(ModelMetadata.NameFor<Account>(nameof(Account.AccountCustodianId)))
            </th>
            <th></th>
            </tr>
            </thead>
            <tbody>
            <ObjectList Data=@Models>
            <tr>
            <td>
            <a href="@($"{PageIndexUri}/Details/{context.AccountId}")" @onclick="@(args => NavigateToDetail(context, args))"
            @onclick:preventDefault>
            @context.AccountNavigation.AccountObjectCode.ToUpper()
            </a>

            </td>
            <td>@context.AccountNavigation.ObjectDisplayName</td>
            <td>@context.AccountNavigation.StartDate.ToShortDateString()</td>
            <td>@context.AccountNavigation.CloseDate?.ToShortDateString()</td>
            <td>@context.AccountNumber</td>
            <td>@context.DisplayOrder</td>
            <td>@context.BooksClosedDate?.ToShortDateString()</td>
            <td>@context.IsComplianceTradable</td>
            <td>@context.HasWallet</td>
            <td>@context.HasBankTransaction</td>
            <td>@context.HasBrokerTransaction</td>
            <td>@context.AccountCustodian?.CustodianCode</td>
            </tr>
            </ObjectList>
            </tbody>
            </table>*@
    </span>
}

@code {
    /// <inheritdoc/>
    protected override string PageTitle => StringResource.Title_AccountIndex;

    /// <inheritdoc/>
    protected override Task OnInitializedAsync()
    {
        MaxRecordCount = -1;

        return base.OnInitializedAsync();
    }

    private void NavigateToDetail(Account model, MouseEventArgs args)
    {
        NavigateToDetail($"{model.AccountId}");
    }
}